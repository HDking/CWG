function vwdStreamer(){if(document.vwdStreamerInstance!=null){document.vwdStreamerInstance.log(vwdStreamerLogLevel.ERROR,"vwdStreamer instance initialized twice, please make sure only one instance is used on the page!!!");return document.vwdStreamerInstance;}else{document.vwdStreamerInstance=this;}var q="1.0.20160526";var t=5*1000;var p=51200;var h="quotecast.vwdservices.com";var i=this;this.lastConnectTime=null;var d=null;this.streamerImplementation=null;var u=null;var z=null;var c=null;var K=null;var O=false;var M=null;var V=null;var L=null;var aa=[];var n=[];var Y=[];var U=[];var N=[];var E=[];var r={};var o=null;var W={};var A={};var D=null;var T={};var J=null;var m="vwdStreamer-internal-nolog";var C=(new Date()).getTime();var X=/=\?(&|$)/;var Q=/^\/Date\(([0-9]+)\)\/$/;var B=Object.prototype.toString;this.state=vwdStreamerState.NONE;this.controlQueue=new vwdStreamerQueue();this.initialize=function(aj,ai,af,ak){if(this.state!==vwdStreamerState.NONE){return;}this._setState(vwdStreamerState.INITIALIZING);if(arguments.length===0){c=h;if("https:"==document.location.protocol){O=true;}else{O=false;}}else{z=aj;c=ai;K=af;O=ak?true:false;}S();var ae=this;this.streamerImplementation=new vwdStreamerPollingImplementation(this,c,K,O);this.streamerImplementation.initialize();ae.registerStaticData({logName:m,handles:/vwdStreamer\.CurrentTime/,interval:1,dataType:"internal-function",update:function(){return{"vwdStreamer.CurrentTime":new Date()};}});ae.registerStaticData({logName:m,handles:/vwdStreamer\.State/,interval:1,dataType:"internal-function",update:function(){switch(ae.state){case vwdStreamerState.CONNECTED:return{"vwdStreamer.State":vwdStreamerState.CONNECTED};default:return{"vwdStreamer.State":vwdStreamerState.DISCONNECTED};}}});for(var ag=0;ag<vwdStreamer._calculatedFieldDefinitions.length;ag++){var ah=vwdStreamer._calculatedFieldDefinitions[ag];ae[ah.method].call(this,ah.options);}R();setInterval(function(){if(!ae.controlQueue.isEmpty()&&ae.isEnabled()){if(ae.streamerImplementation.isControlSlotAvailable()){ae.streamerImplementation.sendDataToServer(ae.controlQueue.dequeue());}}},50);setInterval(function(){ae._checkHeartbeatAndReconnect();},t);if(this.state==vwdStreamerState.INITIALIZING){this._setState(vwdStreamerState.INITIALIZED);}};this.connect=function(){};this.getSubscription=function(af){var ae=new vwdStreamerSubscription(this,af);Y[Y.length]=ae;return ae;};this.removeSubscription=function(af){var ag=null;for(var ae=0;ae<Y.length;ae++){if(Y[ae]===af){ag=ae;break;}}af.unsubscribeAllFields();if(ag!=null){Y.splice(ag,1);}};this.addLogListener=function(af,ag){var ae={listener:af,logLevel:ag};U[U.length]=ae;};this.removeLogListener=function(ag){var ae=null;for(var af=0;af<U.length;af++){if(U[af]==ag){ae=af;break;}}if(ae!=null){U.splice(ae,1);}};this.isConnected=function(){return(this.state==vwdStreamerState.CONNECTED);};this.isInitialized=function(){return this.state>=vwdStreamerState.INITIALIZED;};this.getVersion=function(){return q;};this.getSessionId=function(){return u;};this.setUserToken=function(ae){M=ae;};this.getUserToken=function(){return M;};this.setUpdateInterval=function(ae){V=ae;};this.getUpdateInterval=function(){return V;};this.setTimezone=function(ae){if(typeof moment==="function"&&typeof moment().tz==="function"){L=ae;}else{g(vwdStreamerLogLevel.ERROR,'Required libraries "moment" and "moment-timezone" libraries not detected, using default CET...');}};this.getTimezone=function(){return L;};this.enable=function(){if(this.state===vwdStreamerState.DISABLED){this.state=vwdStreamerState.RECONNECTING;if(T["vwdStreamer.State"]){i.updateField("vwdStreamer.State",this.state,vwdStreamerDataType.NUMBER);}x();y(vwdStreamerReconnectType.REENABLE);}};this.disable=function(){if(this.state!==vwdStreamerState.DISABLED){var ag=this.state===vwdStreamerState.CONNECTED;this.state=vwdStreamerState.DISABLED;this.controlQueue.clear();if(T["vwdStreamer.State"]){i.updateField("vwdStreamer.State",this.state,vwdStreamerDataType.NUMBER);}x();if(ag){var af="";for(var ae in r){if(r.hasOwnProperty(ae)&&!A[ae]&&!T[ae]){af+=G(ae);}if(af.length>p){this.controlQueue.enqueue(af);af="";}}if(af){this.streamerImplementation.sendDataToServer(af);}}u=null;aa=[];n=[];}};this.isEnabled=function(){return this.state!==vwdStreamerState.DISABLED;};this.registerStaticData=function(at){if(!J){J=[];}J.push(at);var ah=at.registeredFields={};var au=0;var ax=false;var ap=null;var aA=0;var aB=at.interval;var al=null;var ai=at.url;var az=at.dataType;var ag=at.ignoreUnchangedValues;var av=at.dataFormatterFunction||ay;var af=at.dataSeparator||";";var ae=at.error;var aw=false;var aD=ai||at.logName||"(unknown)";at.provides=function aC(aE){return at.handles.test(aE);};at.startOrStopIfNeeded=function(){if(!i.isEnabled()){aw=au>0;if(ap){window.clearTimeout(ap);ap=null;ax=false;}}else{if(aw){aw=false;if(!ax){ax=true;if(ap){window.clearTimeout(ap);}if(aD!==m){g(vwdStreamerLogLevel.INFO,"Starting static data "+aD);}ap=window.setTimeout(ar,100);}}}};at.subscribe=function an(aF){var aE=T[aF];if(aE){T[aF]=aE+1;}else{T[aF]=1;}aE=ah[aF];if(aE>0){ah[aF]=aE+1;}else{ah[aF]=1;au++;ax=false;aw=true;if(ap){if(aD!==m){g(vwdStreamerLogLevel.INFO,"Stopping static data "+aD);}window.clearTimeout(ap);ap=null;}}};at.unsubscribe=function aj(aF){var aE=T[aF];if(aE>1){T[aF]=aE-1;}else{if(aE==1){delete T[aF];}}aE=ah[aF];if((aE||0)<2){delete ah[aF];au--;if(au===0){ax=false;aw=false;if(ap){if(aD!==m){g(vwdStreamerLogLevel.INFO,"Stopping static data "+aD);}window.clearTimeout(ap);ap=null;}}}else{ah[aF]=aE-1;}};function ar(){ap=null;if(!ax){return;}try{ak();}catch(aE){if(ae){ae(aE);}else{g(vwdStreamerLogLevel.ERROR,"Calculated field error: "+aE);}}if(ap==null&&(aB>0||aA>0)){if(aA>0){ap=window.setTimeout(ar,aA*1000);}else{ap=window.setTimeout(ar,aB*1000);}}}function ak(){if(az=="jsonp"){w(am(ai,az),ao);}else{if(az=="script"){w(am(ai,az));}else{if(az=="internal-function"||az==null&&typeof at.update==="function"){ao(at.update());}else{throw new Error("dataType "+az+" is not supported.");}}}}function ao(aE){if(!i.isEnabled()){return;}try{if(at.dataFilter){aE=at.dataFilter(aE);}aq(aE);}catch(aF){if(ae){ae(aF);}else{g(vwdStreamerLogLevel.ERROR,"Calculated field error: "+aF);}}}function aq(aG,aJ){var aI;if(!aJ){al=null;aA=0;}if(B.call(aG)==="[object Array]"){for(var aE=0;aE<aG.length;aE++){var aF=aG[aE];if(aF.dataType&&(typeof aF.value!=="string"||aF.dataType===vwdStreamerDataType.STRING)){i._update(aF.field,aF.value,aF.dataType,null,ag);}else{aI=v(aF.value);i._update(aF.field,aI.value,aI.dataType,null,ag);}}}else{if(B.call(aG)==="[object Object]"){if(!aJ&&typeof aG.items!=="undefined"){al=aG.continueToken;aA=aG.ttl;aq(aG.items,true);}else{for(var aH in aG){if(aG.hasOwnProperty(aH)){aI=v(aG[aH]);i._update(aH,aI.value,aI.dataType,null,ag);}}}}else{g(vwdStreamerLogLevel.WARNING,"JSON data could not be processed. Data: "+aG+"; "+B(aG));}}}function ay(aE){return encodeURIComponent(aE.join(af));}function am(aF,aE){return aF.replace(/\{(data|items|fields|continue)\}/g,function(aL,aK){var aJ,aG,aI;switch(aK){case"data":aI=[];for(aJ in ah){if(ah.hasOwnProperty(aJ)){aI.push(aJ);}}return av(aI);case"items":aG={};aI=[];for(aJ in ah){if(ah.hasOwnProperty(aJ)){var aH=f(aJ);if(!aG[aH]){aG[aH]=true;aI.push(aH);}}}return av(aI);case"fields":aG={};aI=[];for(aJ in ah){if(ah.hasOwnProperty(aJ)){var aM=b(aJ);if(!aG[aM]){aG[aM]=true;aI.push(aM);}}}return av(aI);case"continue":return encodeURIComponent(al||"");}});}};function k(ag){if(J){for(var ae=0;ae<J.length;ae++){var af=J[ae];if(af.provides(ag)){af.subscribe(ag);return true;}}}return false;}function P(ag){if(T&&T[ag]){for(var ae=0;ae<J.length;ae++){var af=J[ae];if(af.registeredFields[ag]){af.unsubscribe(ag);return true;}}}return false;}function x(){if(J&&T){for(var ae=0;ae<J.length;ae++){var af=J[ae];af.startOrStopIfNeeded();}}}this._subscribe=function(ae){if(this.state<vwdStreamerState.CONNECTING){i.requestSession();}try{var ai="";for(var af=0;af<ae.length;af++){var ah=ae[af];ai+=I(ah);if(ai.length>p){if(i.isEnabled()){this.controlQueue.enqueue(ai);}ai="";}}if(ai.length>0&&i.isEnabled()){this.controlQueue.enqueue(ai);}Z();x();}catch(ag){g(vwdStreamerLogLevel.ERROR,ag);}};this._unsubscribe=function(ae){try{var ai="";for(var af=0;af<ae.length;af++){var ah=ae[af];ai+=e(ah);if(ai.length>p){if(i.isEnabled()){this.controlQueue.enqueue(ai);}ai="";}}if(ai.length>0&&i.isEnabled()){this.controlQueue.enqueue(ai);}}catch(ag){g(vwdStreamerLogLevel.ERROR,ag);}};this._checkHeartbeatAndReconnect=function(){if(!i.isEnabled()){return;}var ae=new Date();if(this.state==vwdStreamerState.CONNECTED||this.state==vwdStreamerState.DISCONNECTED||(this.state==vwdStreamerState.RECONNECTING&&u==null)){if(ae-d>t*2){this._setState(vwdStreamerState.DISCONNECTED);g(vwdStreamerLogLevel.INFO,"No data received for "+((ae-d)/1000)+" seconds, reconnecting...");y(vwdStreamerReconnectType.CONNECTION_LOST);return;}}};this._getCachedValue=function(ae){return N[ae];};this._update=function(af,an,am,ae,ag){if(am==null){am=a(an);}if(typeof an==="number"&&(isNaN(an)||!isFinite(an))){an=null;}if(an===""){an=null;}var ap=this._getCachedValue(af);ap=ap!=null?ap.value:null;if(ag&&an===ap&&!ae){return;}var al=new vwdStreamerDataPacket(af,an,ap);var ah=H(b(af));if(ah==null){al.type=am;al.value=an;al.oldValue=ap;if(am===vwdStreamerDataType.ARRAY){al.values=an;al.oldValues=ap;}else{al.values=null;al.oldValues=null;}}else{var aj=ah.getParsedValues(al.rawValue,L);al.type=aj.type;al.value=aj.value;al.values=aj.values;if(aj.rawValue){al.rawValue=aj.rawValue;}var ao=ah.getParsedValues(al.oldRawValue);al.oldValue=ao.value;al.oldValues=ao.values;}j(af,al.rawValue,am);if(ae!=null){ae.update(al);return;}else{for(var ai=0;ai<Y.length;ai++){try{Y[ai].update(al);}catch(ak){var aq=ak.toString();if(aq instanceof Error){aq=ak.message;if(ak.fileName&&ak.lineNumber){aq+=" at "+ak.fileName+", line "+ak.lineNumber;}if(ak.stack){aq+="\n"+ak.stack;}}else{aq+=" in user-defined callback; stack trace not available";}g(vwdStreamerLogLevel.ERROR,"Error publishing message to subscriber, error: "+aq);}}}ac(al);};this.setSessionId=function(af){if(!i.isEnabled()){return;}g(vwdStreamerLogLevel.TRACE,"SessionId received: "+af);u=af;var ae=i.state;i.onDataRecieved();i.streamerImplementation.notifyConnected();if(ae>vwdStreamerState.CONNECTING){i.refreshSubscriptions();}};this.unauthorized=function(){if(!i.isEnabled()){return;}g(vwdStreamerLogLevel.WARNING,"User not authorized");};this.heartbeatReceived=function(){if(!i.isEnabled()){return;}i.onDataRecieved();};this.ackSubscribe=function(af,ae){if(!i.isEnabled()){return;}i.onDataRecieved();aa[af]=ae;n[ae]=af;};this.ackUnsubscribe=function(ae){if(!i.isEnabled()){return;}i.onDataRecieved();delete n[aa[ae]];delete aa[ae];s(ae);};this.update=function(ag,ah,af){if(!i.isEnabled()){return;}i.onDataRecieved();var ae=this._getDataNameById(ag);if(ae==null){return;}af=vwdStreamerDataType.parseDataType(af,ah);if(af==vwdStreamerDataType.TIME){ah=Date.parseVwdStreamerTime(ah);}else{if(af==vwdStreamerDataType.DATE){ah=Date.parseVwdStreamerDate(ah);}else{if(af==vwdStreamerDataType.DATETIME){ah=Date.parseVwdStreamerDateTime(ah);}}}this._update(ae,ah,af);};this.updateField=this._update;this.accessDenied=function(ae,af){if(!i.isEnabled()){return;}i.onDataRecieved();g(vwdStreamerLogLevel.WARNING,ae+" not subscribed. Reason: "+af);};this.refreshSubscriptions=function(){i.onDataRecieved();g(vwdStreamerLogLevel.TRACE,"Refreshing subscription set...");var af="";for(var ae in r){if(!A[ae]&&!T[ae]){af+=ab(ae);if(af.length>p){this.controlQueue.enqueue(af);af="";}}}if(af.length>0){this.controlQueue.enqueue(af);}};this.requestSession=function(){u=null;if(!i.isEnabled()){return;}else{if(i.state==vwdStreamerState.INITIALIZED){i._setState(vwdStreamerState.CONNECTING);}else{i._setState(vwdStreamerState.RECONNECTING);}}g(vwdStreamerLogLevel.TRACE,"Requesting user session...");var af=(O?"https://":"http://")+c;if(K!=null){af+=":"+K;}af+="/request_session?version="+encodeURIComponent(q);if(M){af+="&userToken="+encodeURIComponent(M);}if(V){af+="&updateInterval="+encodeURIComponent(V);}var ah=document.getElementsByTagName("head")[0];var ag=document.createElement("script");ag.async=true;ag.type="text/javascript";ag.src=af;var ae=false;ag.onload=ag.onreadystatechange=function(){if(!ae&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){ae=true;ag.onload=ag.onreadystatechange=null;if(ah&&ag.parentNode){ah.removeChild(ag);}}};this.lastConnectTime=new Date();ah.insertBefore(ag,ah.firstChild);};this.onDataRecieved=function(){d=new Date();this._setState(vwdStreamerState.CONNECTED);};this.registerCalculatedField=function(ae){if(o==null){o=[];}o.push(new vwdStreamerCalculatedFieldDefinition(this,ae));};function F(ah){if(o){var ae=A[ah];if(ae){return ae.fieldDef;}for(var ag=0;ag<o.length;ag++){var af=o[ag];if(af.provides(ah)){return af;}}}return null;}function ad(af){var ag=null;var ah=F(af);if(ah){ag="";if(A[af]==null){var ae=ah.createInstance(af);A[af]=ae;for(var ak=0;ak<ae.dependencies.length;ak++){var aj=ae.dependencies[ak];var ai=W[aj];if(ai==null){W[aj]=ai={};}ai[af]=ae;if(!D){D={};}D[aj]=true;ag+=I(aj);}ae.subscribed(af);}}return ag;}function l(ai){var af=null;var ae=A[ai];if(ae){af="";delete A[ai];for(var ag=0;ag<ae.dependencies.length;ag++){var aj=ae.dependencies[ag];var ah=W[aj];delete ah[ai];af+=e(aj);}ae.unsubscribed(ai);}return af;}function ac(ah){var ag=W[ah.dataName];if(ag){for(var af in ag){if(ag.hasOwnProperty(af)){var ae=ag[af];ae._doUpdate(ah);}}}}function Z(){if(D){for(var ae in D){if(D.hasOwnProperty(ae)){var af=i._getCachedValue(ae);if(af){ac(af);}}}D=null;}}this._setState=function(ae){this.state=ae;};var S=function(){var ae;if(typeof TExParser==="function"){ae=new TExParser();E[ae.getFieldName()]=ae;}if(typeof ZExParser==="function"){ae=new ZExParser();E[ae.getFieldName()]=ae;}if(typeof BlockExParser==="function"){ae=new BlockExParser();E[ae.getFieldName()]=ae;}};var g=function(ah,af){for(var ae=0;ae<U.length;ae++){var ag=U[ae];if(ah>=ag.logLevel){ag.listener(ah,af);}}if(window.console){switch(ah){case vwdStreamerLogLevel.ERROR:if(window.console.error){window.console.error(af);}break;case vwdStreamerLogLevel.WARNING:if(window.console.warn){window.console.warn(af);}break;case vwdStreamerLogLevel.INFO:if(window.console.info){window.console.info(af);}else{if(window.console.log){window.console.log(af);}}break;case vwdStreamerLogLevel.TRACE:if(window.console.debug){window.console.debug(af);}else{if(window.console.info){window.console.info(af);}else{if(window.console.log){window.console.log(af);}}}break;default:if(window.console.debug){window.console.debug(af);}else{if(window.console.info){window.console.info(af);}else{if(window.console.log){window.console.log(af);}}}break;}}};this.log=function(af,ae){g(af,ae);};this._getDataNameById=function(ae){return n[ae];};var j=function(ae,ah,af){if(N[ae]!=null){if(ah==null){delete N[ae];}else{N[ae].value=ah;N[ae].dataType=af;}}else{if(ah!=null){var ag={};ag.dataName=ae;ag.value=ah;ag.dataType=af;N[ae]=ag;}}};var s=function(ae){delete N[ae];};var f=function(ae){if(ae!=null){var af=ae.lastIndexOf(".");if(af>-1){return ae.substring(0,af);}else{return ae;}}return null;};var b=function(ae){if(ae!=null){var af=ae.lastIndexOf(".");if(af>-1){return ae.substring(af+1);}else{return null;}}return null;};function a(af){if(af===null||typeof af==="unknown"){return vwdStreamerDataType.UNKNOWN;}else{if(typeof af==="string"){return vwdStreamerDataType.STRING;}else{if(typeof af==="number"){return vwdStreamerDataType.NUMBER;}else{if(typeof af==="boolean"){return vwdStreamerDataType.BOOLEAN;}else{if(typeof af==="object"){var ae=B.call(af);if(ae==="[object Date]"){return vwdStreamerDataType.DATETIME;}else{if(ae==="[object Array]"){return vwdStreamerDataType.ARRAY;}else{return vwdStreamerDataType.OBJECT;}}}else{return vwdStreamerDataType.UNKNOWN;}}}}}}var I=function(ae){if(ae==="vwdStreamer.HeartBeat"){return"";}if(r[ae]!=null){r[ae]++;return"";}r[ae]=1;var af=ad(ae);if(af!=null){return af;}if(k(ae)){return"";}return ab(ae);};var e=function(ae){if(r[ae]){r[ae]--;if(r[ae]<1){delete r[ae];s(ae);var af=l(ae);if(af!=null){return af;}if(P(ae)){return"";}return G(ae);}}return"";};var H=function(ae){return E[ae];};var y=function(ae){g(vwdStreamerLogLevel.INFO,"Performing reconnect...");i.requestSession();};var ab=function(ae){return"req("+ae+");";};var G=function(ae){return"rel("+ae+");";};var R=function(){i.registerCalculatedField({handles:/([A-Z0-9,\.\|]+)\.(Ask|Bid|Close|CumulativeVolume|High|Low|LimitPrice|Last|OpenAsk|OpenBid|OpenInterest|Open|PreviousClose|IndicativeOpen)DateTime$/i,singleItem:false,dateType:vwdStreamerDataType.DATETIME,getFieldDependencies:function(af){var ai=this.handles.exec(af);var ah=ai[1];var ag=ai[2];var ae=[];ae.push(ah+"."+ag+"Time");ae.push(ah+"."+ag+"Date");return ae;},update:function(ag,am,ae){if(!this._fields){this._fields=this.fieldDef.getFieldDependencies(this.dataName);}for(var ah=0;ah<this._fields.length;ah++){var ak=this._fields[ah];var an=this.values[ak];if(/Date$/i.test(ak)){var ai=an;}else{if(/Time$/i.test(ak)){var af=an;}}if(ai!=null&&af!=null){var al=new Date(ai.getFullYear(),ai.getMonth(),ai.getDate(),af.getHours(),af.getMinutes(),af.getSeconds(),af.getMilliseconds());if(L){if(/Time$/i.test(ag)&&af.isMidnight()&&(ae==null||ae.isMidnight())){return al;}else{var aj=moment.tz(al,"Europe/Amsterdam").tz(L);return new Date(aj.year(),aj.month(),aj.date(),aj.hour(),aj.minute(),aj.second(),aj.millisecond());}}else{return al;}}}}});};function v(af){if(typeof af==="string"){var ae=af.replace(Q,"$1");if(ae===af){return{value:af,dataType:vwdStreamerDataType.STRING};}else{return{value:new Date(parseInt(ae,10)),dataType:vwdStreamerDataType.DATETIME};}}return{value:af,dataType:a(af)};}function w(ag,ak){var ah=document.getElementsByTagName("head")[0]||document.documentElement;var af=document.createElement("script");af.async=true;var aj="vwdStreamer_jsonp_"+C++;if(ak){window[aj]=function(al){try{ak(al);}catch(am){g(vwdStreamerLogLevel.ERROR,"Calculated field error: "+am);}window[aj]=undefined;try{delete window[aj];}catch(am){}if(ah){ah.removeChild(af);}};}var ae=false;var ai=ag.replace(X,"="+aj+"$1");if(ai==ag&&ak){ai=ag+(ag.indexOf("?")==-1?"?":"&")+"callback="+aj;}af.type="text/javascript";af.src=ai;af.onload=af.onreadystatechange=function(){if(!ae&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){ae=true;af.onload=af.onreadystatechange=null;if(ah&&af.parentNode){ah.removeChild(af);}}};ah.insertBefore(af,ah.firstChild);}this.inspect={version:function(){return q;},valueOf:function(ae){var af=N[ae];if(af){return af.value;}else{return NaN;}},isSubscribed:function(ae){return r[ae]!=null;},containsValue:function(ae){return N[ae]!=null;},numberOfSubscriptionsFor:function(ae){return r[ae]||0;},subscribedFieldCount:function(){var ae=0;for(var af in r){ae++;}return ae;},printSubscribedFields:function(){if(window.console){for(var ae in r){if(window.console.info){window.console.info(ae);}else{if(window.console.log){window.console.log(ae);}}}}}};}vwdStreamer._calculatedFieldDefinitions=[];vwdStreamer.registerCalculatedField=function(a){if(document.vwdStreamerInstance){document.vwdStreamerInstance.registerCalculatedField(a);}else{vwdStreamer._calculatedFieldDefinitions.push({method:"registerCalculatedField",options:a});}};vwdStreamer.registerStaticData=function(a){if(document.vwdStreamerInstance){document.vwdStreamerInstance.registerStaticData(a);}else{vwdStreamer._calculatedFieldDefinitions.push({method:"registerStaticData",options:a});}};function vwdStreamerCalculatedFieldDefinition(b,a){this.streamer=b;this.values={};if(a.ignoreUnchangedValues){this.ignoreUnchangedValues=true;}if(typeof a.handles==="function"){this.provides=a.handles;}else{this.handles=a.handles;}if(typeof a.getFieldDependencies==="function"){this.getFieldDependencies=a.getFieldDependencies;if(!a.singleItem){this.singleItem=false;}}else{if(a.dependentFields){this.dependentFields=a.dependentFields.slice(0);}}this.dataType=a.dataType;if(a.treatNullAsNaN){this.treatNullAsNaN=true;}if(typeof a.update==="string"){if(typeof a.treatNullAsNaN==="undefined"){this.treatNullAsNaN=true;}this.update=new Function("dataName","value","with (this.values) { return (<?>); }".replace("<?>",a.update));}else{this.update=a.update;}if(a.subscribed){this.subscribed=a.subscribed;}if(a.unsubscribed){this.unsubscribed=a.unsubscribed;}}vwdStreamerCalculatedFieldDefinition.prototype.streamer=null;vwdStreamerCalculatedFieldDefinition.prototype.ignoreUnchangedValues=false;vwdStreamerCalculatedFieldDefinition.prototype.singleItem=true;vwdStreamerCalculatedFieldDefinition.prototype.treatNullAsNaN=false;vwdStreamerCalculatedFieldDefinition.prototype.handles=null;vwdStreamerCalculatedFieldDefinition.prototype.dependentFields=null;vwdStreamerCalculatedFieldDefinition.prototype.update=null;vwdStreamerCalculatedFieldDefinition.prototype.dataType=1;vwdStreamerCalculatedFieldDefinition.prototype.values=null;vwdStreamerCalculatedFieldDefinition.prototype.provides=function(a){return this.handles.test(a);};vwdStreamerCalculatedFieldDefinition.prototype.getFieldDependencies=function(b){var e=b.lastIndexOf(".");if(e>-1){var d=b.substr(0,e+1);var a=new Array(this.dependentFields.length);for(var c=0;c<this.dependentFields.length;c++){a[c]=d+this.dependentFields[c];}return a;}return[];};vwdStreamerCalculatedFieldDefinition.prototype.createInstance=function(a){return new vwdStreamerCalculatedFieldInstance(this,a);};vwdStreamerCalculatedFieldDefinition.prototype._update=function(a,b){this.streamer._update(a,b,this.dataType,null,this.ignoreUnchangedValues);};function vwdStreamerCalculatedFieldInstance(b,a){this.fieldDef=b;this.dataName=a;var c=a.lastIndexOf(".");if(c>-1){this.fieldIdentifier=a.substr(0,c);this.fieldName=a.substr(c+1);}else{this.fieldIdentifier=a;}this.dependencies=b.getFieldDependencies(a);}vwdStreamerCalculatedFieldInstance.prototype.fieldDef=null;vwdStreamerCalculatedFieldInstance.prototype.dataName=null;vwdStreamerCalculatedFieldInstance.prototype.fieldIdentifier=null;vwdStreamerCalculatedFieldInstance.prototype.fieldName=null;vwdStreamerCalculatedFieldInstance.prototype.values=null;vwdStreamerCalculatedFieldInstance.prototype.value=null;vwdStreamerCalculatedFieldInstance.prototype.dataPacket=null;vwdStreamerCalculatedFieldInstance.prototype._ignore=false;vwdStreamerCalculatedFieldInstance.prototype._oldValue=null;vwdStreamerCalculatedFieldInstance.prototype._updateFired=false;vwdStreamerCalculatedFieldInstance.prototype._hasFiredBefore=false;vwdStreamerCalculatedFieldInstance.prototype.dependencies=null;vwdStreamerCalculatedFieldInstance.prototype.preventUpdate=function(){this._ignore=true;};vwdStreamerCalculatedFieldInstance.prototype._doUpdate=function(a){this._ignore=false;this._updateFired=false;var l=a.dataName,f;if(this.fieldDef.singleItem){f=l.lastIndexOf(".");if(f>-1){l=l.substr(f+1);}}this.values={};var b;for(var h=0;h<this.dependencies.length;h++){var j=this.dependencies[h];var m=j;b=this.fieldDef.streamer._getCachedValue(j);if(this.fieldDef.singleItem){f=j.lastIndexOf(".");if(f>-1){j=j.substr(f+1);}}var k=b==null?undefined:b.value;this.values[j]=k;this.values[m]=k;}b=this.fieldDef.streamer._getCachedValue[this.dataName];if(b){this._oldValue=b.value;this.values[this.dataName]=b.value;}else{this._oldValue=null;this.values[this.dataName]=null;}this.values[a.dataName]=a.value;this.values[l]=a.value;if(this.fieldDef.treatNullAsNaN){for(var c in this.values){if(this.values[c]==null){this.values[c]=Number.NaN;}}}this.dataPacket=a;try{var n=this.fieldDef.update.apply(this,[a.dataName,a.value,a.oldValue]);if(!this._updateFired&&typeof n!=="undefined"){this.update(n);}}catch(g){this.fieldDef.streamer.log(vwdStreamerLogLevel.ERROR,"Calculated field error: "+g);}this.dataPacket=null;};vwdStreamerCalculatedFieldInstance.prototype.update=function(a){this._updateFired=true;if(!this._ignore){if(typeof a==="number"&&(isNaN(a)||!isFinite(a))){a=null;}this.value=a;if(this._oldValue==null&&a==null&&this._hasFiredBefore){return;}this._hasFiredBefore=true;this.fieldDef._update(this.dataName,a);}};vwdStreamerCalculatedFieldInstance.prototype.subscribed=function(a){if(this.fieldDef.subscribed){this.fieldDef.subscribed.call(this,a);}};vwdStreamerCalculatedFieldInstance.prototype.unsubscribed=function(a){if(this.fieldDef.unsubscribed){this.fieldDef.unsubscribed.call(this,a);}};function vwdStreamerDataPacket(a,c,b){this.dataName=a;this.rawValue=c;this.oldRawValue=b;}vwdStreamerDataPacket.prototype.dataName=null;vwdStreamerDataPacket.prototype.type=null;vwdStreamerDataPacket.prototype.rawValue=null;vwdStreamerDataPacket.prototype.value=null;vwdStreamerDataPacket.prototype.values=null;vwdStreamerDataPacket.prototype.oldRawValue=null;vwdStreamerDataPacket.prototype.oldValue=null;vwdStreamerDataPacket.prototype.oldValues=null;function vwdStreamerTick(e,d,c,f,a,b){this.tickType=e;this.dateTime=typeof d==="string"?Date.parseVwdStreamerDateTime(d):d;this.price=c;this.indication=f;this.lastVolume=a;this.cumulativeVolume=b;}function TExParser(){var a="T!";this.getFieldName=function(){return a;};this.getParsedValues=function(f,d){var b={};if(f!=null&&f.length>0){var c=f.split("|");b.values=new vwdStreamerTick(c[0]!==""?c[0].substr(0,1):null,c[0]!==""?c[0].substr(1):null,c[1]!==""?Number(c[1]):null,c[2]!==""?c[2]:null,c[3]!==""?Number(c[3]):null,c[4]!==""?Number(c[4]):null);b.value=b.values.price;b.type=vwdStreamerDataType.NUMBER;if(d&&!b.values.dateTime.isMidnight()){var e=moment.tz(b.values.dateTime,"Europe/Amsterdam").tz(d);b.values.dateTime=new Date(e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond());b.rawValue=(b.values.tickType!=null?b.values.tickType:"")+e.format("YYYY-MM-DD HH:mm:ss")+f.substring(f.indexOf("|"));}}return b;};}function ZExParser(){var a="Z!";this.getFieldName=function(){return a;};this.getParsedValues=function(f,d){var b={};if(f!=null&&f.length>0){var c=f.split("|");b.values=new vwdStreamerTick(c[0]!==""?c[0].substr(0,1):null,c[0]!==""?c[0].substr(1):null,c[1]!==""?Number(c[1]):null,c[2]!==""?c[2]:null,c[3]!==""?Number(c[3]):null,c[4]!==""?Number(c[4]):null);b.value=b.values.price;b.type=vwdStreamerDataType.NUMBER;if(d&&!b.values.dateTime.isMidnight()){var e=moment.tz(b.values.dateTime,"Europe/Amsterdam").tz(d);b.values.dateTime=new Date(e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond());b.rawValue=(b.values.tickType!=null?b.values.tickType:"")+e.format("YYYY-MM-DD HH:mm:ss")+f.substring(f.indexOf("|"));}}return b;};}function BlockExParser(){var a="Block!";this.getFieldName=function(){return a;};this.getParsedValues=function(f,d){var b={};if(f!=null&&f.length>0){var c=f.split("|");b.values=new vwdStreamerTick(c[0]!==""?c[0].substr(0,1):null,c[0]!==""?c[0].substr(1):null,c[1]!==""?Number(c[1]):null,null,c[3]!==""?Number(c[3]):null,c[4]!==""?Number(c[4]):null);b.value=b.values.price;b.type=vwdStreamerDataType.NUMBER;if(d&&!b.values.dateTime.isMidnight()){var e=moment.tz(b.values.dateTime,"Europe/Amsterdam").tz(d);b.values.dateTime=new Date(e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond());b.rawValue=(b.values.tickType!=null?b.values.tickType:"")+e.format("YYYY-MM-DD HH:mm:ss")+f.substring(f.indexOf("|"));}}return b;};}function vwdStreamerPollingImplementation(c,b,a,d){this.streamer=c;this.host=b;this.port=a;this.secure=d;}vwdStreamerPollingImplementation.prototype.streamer=null;vwdStreamerPollingImplementation.prototype.host=null;vwdStreamerPollingImplementation.prototype.port=null;vwdStreamerPollingImplementation.prototype.secure=false;vwdStreamerPollingImplementation.prototype.initialized=false;vwdStreamerPollingImplementation.prototype.controlFormAvailable=true;vwdStreamerPollingImplementation.prototype.controlForm=null;vwdStreamerPollingImplementation.prototype.controlResponseFrame=null;vwdStreamerPollingImplementation.prototype.pollingConnectionAvailable=true;vwdStreamerPollingImplementation.prototype._pendingUpdates=[];vwdStreamerPollingImplementation.prototype._MAX_PROCESS_TIME=1000;vwdStreamerPollingImplementation.isSupported=function(){return true;};vwdStreamerPollingImplementation.prototype.initialize=function(){if(this.initialized){return;}var a=this;setInterval(function(){if(a.pollingConnectionAvailable&&a.streamer.isEnabled()&&a.streamer.getSessionId()){a.pollServerForData(a.streamer.getSessionId());}},100);this.initialized=true;};vwdStreamerPollingImplementation.prototype.isControlSlotAvailable=function(){return(this.streamer.getSessionId()!=null&&this.controlFormAvailable);};vwdStreamerPollingImplementation.prototype.sendDataToServer=function(b){this.controlFormAvailable=false;if(!this.controlResponseFrame){this.controlResponseFrame=this._getResponseFrame();}if(!this.controlForm){this.controlForm=this._getControlForm();}this.controlForm.target=this.controlResponseFrame.name;this.controlForm.action=this._getControlURL(this.streamer.getSessionId());this.controlForm.controlData.value=b;var a=false;this.controlResponseFrame.onload=this.controlResponseFrame.onreadystatechange=function(c){if(!a&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){a=true;c=c||window.event;if(c.stopPropagation){c.stopPropagation();}c.cancelBubble=true;this.onload=this.onreadystatechange=null;this.streamerImplementation.controlFormAvailable=true;}};this.controlForm.submit();};vwdStreamerPollingImplementation.prototype.notifyConnected=function(){this.pollingConnectionAvailable=true;};vwdStreamerPollingImplementation.prototype.pollServerForData=function(d){this.pollingConnectionAvailable=false;var c=document.getElementsByTagName("head")[0];var b=document.createElement("script");b.async=true;b.type="text/javascript";b.src=this._getDataURL(d);var a=false;b.onload=b.onreadystatechange=function(){if(!a&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){a=true;b.onload=b.onreadystatechange=null;if(c&&b.parentNode){c.removeChild(b);}}};this.streamer.lastConnectTime=new Date();c.insertBefore(b,c.firstChild);};vwdStreamerPollingImplementation.prototype.handleResponse=function(b){var c=this._pendingUpdates.length===0;this._pendingUpdates=this._pendingUpdates.concat(b);this.pollingConnectionAvailable=true;var a=this;if(c){setTimeout(function(){a.processUpdates();},0);}};vwdStreamerPollingImplementation.prototype.processUpdates=function(){var c=new Date().getTime();var b=c;while(this._pendingUpdates.length>0&&((b-c)<this._MAX_PROCESS_TIME)){var g=this._pendingUpdates.shift();try{switch(g.m){case"s":break;case"d":if(g.v.length==2){this.streamer.accessDenied(g.v[0],g.v[1]);}break;case"un":if(g.v.length==2&&!this._skipMessage(g,this._pendingUpdates)){this.streamer.update(g.v[0],g.v[1],"NUMBER");}break;case"us":if(g.v.length==2&&!this._skipMessage(g,this._pendingUpdates)){this.streamer.update(g.v[0],g.v[1],"STRING");}break;case"ue":if(g.v.length==1&&!this._skipMessage(g,this._pendingUpdates)){this.streamer.update(g.v[0],null,"UNKNOWN");}break;case"a_req":if(g.v.length==2){this.streamer.ackSubscribe(g.v[0],g.v[1]);}break;case"a_rel":if(g.v.length==1){this.streamer.ackSubscribe(g.v[0]);}break;case"h":this.streamer.heartbeatReceived();break;case"sr":this.streamer.requestSession();break;default:this.streamer.log(vwdStreamerLogLevel.WARNING,"Unknown message type, skipping message: "+g.m);}}catch(f){var d=f.toString();if(d instanceof Error){d=f.message;if(f.fileName&&f.lineNumber){d+=" at "+f.fileName+", line "+f.lineNumber;}if(f.stack){d+="\n"+f.stack;}}else{d+=" in user-defined callback; stack trace not available";}this.streamer.log(vwdStreamerLogLevel.ERROR,"Error handling message "+g.m+", error: "+d);}b=new Date().getTime();}if(this._pendingUpdates.length>0){var a=this;setTimeout(function(){a.processUpdates();},0);}};vwdStreamerPollingImplementation.prototype._skipMessage=function(d,b){if(!this.streamer.isEnabled()){return true;}else{var c=this.streamer._getDataNameById(d.v[0]);if(c&&c.search(/!$/i)>0){return false;}}for(var a=0;a<b.length;a++){if(/^(un|us|ue)$/i.test(b[a].m)&&d.v[0]===b[a].v[0]){return true;}}};vwdStreamerPollingImplementation.prototype._getDataURL=function(b){var a="";if(this.host!=null){a+=(this.secure?"https://":"http://")+this.host;}if(this.port!=null){a+=":"+this.port;}a+="/POLLING/";if(b!=null){a+=encodeURIComponent(b);}return a;};vwdStreamerPollingImplementation.prototype._getControlURL=function(b){var a="";if(this.host!=null){a+=(this.secure?"https://":"http://")+this.host;}if(this.port!=null){a+=":"+this.port;}a+="/POLLING/";if(b!=null){a+=encodeURIComponent(b);}return a;};vwdStreamerPollingImplementation.prototype._getResponseFrame=function(){var b="vwdStreamerControlResponseFrame_"+this._createGUID();var a=this._createElementInternal("iframe",b);a.name=b;a.height=a.width=0;a.hidden=true;a.style.visibility="hidden";a.style.position="absolute";a.streamerImplementation=this;document.body.appendChild(a);return a;};vwdStreamerPollingImplementation.prototype._getControlForm=function(){var c="vwdStreamerControlForm_"+this._createGUID();var a=this._createElementInternal("form","name");a.id=a.name=c;a.hidden=true;a.style.visibility="hidden";a.method="POST";document.body.appendChild(a);var b=this._createElementInternal("input","controlData");b.type="hidden";b.id=b.name="controlData";a.appendChild(b);return a;};vwdStreamerPollingImplementation.prototype._createElementInternal=function(c,a){try{return document.createElement("<"+c+' name="'+a+'">');}catch(b){return document.createElement(c);}};vwdStreamerPollingImplementation.prototype._createGUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(d){var b=Math.random()*16|0,a=d==="x"?b:(b&3|8);return a.toString(16);});};function vwdStreamerQueue(){var a=[];this.enqueue=function(b){a.push(b);};this.enqueueFirst=function(b){a.unshift(b);};this.dequeue=function(){return a.shift();};this.isEmpty=function(){return a.length===0;};this.clear=function(){a.length=0;};}function vwdStreamerSubscription(d,c){var b=d;var a=c;var e={};this.subscribe=function(g){if(!g){return;}else{if(typeof g==="string"){g=[g];}}var f=[];for(var h=0;h<g.length;h++){var l=g[h];if(e[l]){f.push(h);}else{e[l]=true;}var k=b._getCachedValue(l);if(k!=null){b._update(k.dataName,k.value,k.dataType,this);}}if(f.length>0){g=g.slice(0);for(var j=f.length-1;j>=0;j--){g.splice(f[j],1);}}b._subscribe(g);};this.unsubscribe=function(f){if(!f){return;}else{if(typeof f==="string"){f=[f];}}var j=[];for(var g=0;g<f.length;g++){var k=f[g];if(e[k]){delete e[k];}else{j.push(g);}}if(j.length>0){f=f.slice(0);for(var h=j.length-1;h>=0;h--){f.splice(j[h],1);}}b._unsubscribe(f);};this.unsubscribeAllFields=function(){var f=[];for(var g in e){if(e.hasOwnProperty(g)){f.push(g);}}b._unsubscribe(f);e=[];};this.update=function(f){if(e[f.dataName]){a(f);}};}var vwdStreamerLogLevel={TRACE:0,INFO:1,WARNING:2,ERROR:3};var vwdStreamerState={NONE:0,INITIALIZING:1,INITIALIZED:2,CONNECTING:3,CONNECTED:4,RECONNECTING:5,DISCONNECTED:6,DISABLED:7};var vwdStreamerDataType={UNKNOWN:0,NUMBER:1,STRING:2,DATE:3,TIME:4,DATETIME:5,BOOLEAN:10,OBJECT:11,ARRAY:12};var vwdStreamerReconnectType={CONNECTION_INITIALIZE:0,REFRESH:1,CONNECTION_LOST:2,REENABLE:3};var vwdStreamerBrowser=(function(){var e=/mozilla/i,a=/webkit/i,c=/opera/i,b=/msie/i,d=navigator.userAgent;return{userAgent:d,isMozilla:function(){return e.test(d)&&!/(compatible|webkit)/i.test(d);},isWebkit:function(){return a.test(d);},isOpera:function(){return c.test(d);},isIE:function(){return b.test(d);}};})();vwdStreamerDataType.parseDataType=(function(){var b=/^([01][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$/;var c=/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[01])$/;var a=/^[0-9]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][0-9]|3[01]) ([01][0-9]|2[0-3]):[0-5][0-9]:[0-5][0-9]$/;return function(d,e){if(d=="NUMBER"){return vwdStreamerDataType.NUMBER;}if(d=="DATE"){if(c.test(e)){return vwdStreamerDataType.DATE;}else{return vwdStreamerDataType.STRING;}}if(d=="TIME"){if(b.test(e)){return vwdStreamerDataType.TIME;}else{return vwdStreamerDataType.STRING;}}if(d=="DATETIME"){if(a.test(e)){return vwdStreamerDataType.DATETIME;}else{return vwdStreamerDataType.STRING;}}if(d=="STRING"){if(b.test(e)){return vwdStreamerDataType.TIME;}else{if(c.test(e)){return vwdStreamerDataType.DATE;}else{if(a.test(e)){return vwdStreamerDataType.DATETIME;}else{return vwdStreamerDataType.STRING;}}}}return vwdStreamerDataType.UNKNOWN;};})();Date.parseVwdStreamerTime=function(b){var a=new Date();a.setHours(b.substring(0,2));a.setMinutes(b.substring(3,5));a.setSeconds(b.substring(6,8));a.setMilliseconds(0);return a;};Date.parseVwdStreamerDate=function(a){return new Date(a.substring(0,4),(Number(a.substring(5,7))-1),a.substring(8,10));};Date.parseVwdStreamerDateTime=function(b){var a=new Date();a.setFullYear(b.substring(0,4));a.setMonth(Number(b.substring(5,7))-1);a.setDate(b.substring(8,10));a.setHours(b.substring(11,13));a.setMinutes(b.substring(14,16));a.setSeconds(b.substring(17,19));a.setMilliseconds(0);return a;};Date.prototype.isMidnight=function(){return this.getHours()==0&&this.getMinutes()==0&&this.getSeconds()==0;};if(!document.getElementById&&document.all){document.getElementById=function(a){return document.all[a];};}